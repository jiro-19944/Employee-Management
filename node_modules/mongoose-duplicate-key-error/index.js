var mongoose = require('mongoose');

var isMongoError = function(err) {
	return err && err.name === 'MongoError' && (err.code === 11000 || err.code === 11001);
};

module.exports = function(err, options) {
	if(isMongoError(err)) {
		options = options || {};

		var model = options.model;
		var path = options.path || (model && model.modelName.toLowerCase()) || 'duplicate';

		var validationError = new mongoose.Error.ValidationError(model);
		var validatorError = new mongoose.Error.ValidatorError({
			message: options.message ||Â 'Duplicate key error',
			type: options.type || 'duplicate key',
			path: path
		});

		validatorError.stack = err.stack;
		validationError.errors[path] = validatorError;

		return validationError;
	}

	return err;
};
